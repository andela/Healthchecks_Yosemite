{% load hc_extras humanize %}
{% load hc_assign_tag %}
<table id="checks-table" class="table hidden-xs">
    <tr>
        <th></th>
        <th class="th-name">Name</th>
        <th>Ping URL</th>
        <th class="th-period">
            Period <br />
            <span class="checks-subline">Grace</span>
        </th>
        <th>Last Ping</th>
        <th></th>
    </tr>

    {% for check in checks_to_display %}
        {% if check in accessible_checks %}

            {% for check_scope in check_scopes %}
                {% if check.code == check_scope.0.check_code %}
                    {% define check_scope.1 as scope %}
                    <tr class="checks-row">
                    <td class="indicator-cell">
                        {% if check.get_status == "new" %}
                            <span class="status icon-up new"
                                data-toggle="tooltip" title="New. Has never received a ping."></span>
                        {% elif check.get_status == "paused" %}
                            <span class="status icon-paused"
                                data-toggle="tooltip" title="Monitoring paused. Ping to resume."></span>
                        {% elif check.in_grace_period %}
                            <span class="status icon-grace"></span>
                        {% elif check.get_status == "up" %}
                            <span class="status icon-up"></span>
                        {% elif check.get_status == "down" %}
                            <span class="status icon-down"></span>
                        {% endif %}
                    </td>
                    <td class="name-cell">
                        <div data-name="{{ check.name }}"
                                data-tags="{{ check.tags }}"
                                data-url="{% url 'hc-update-name' check.code %}"
                                class="my-checks-name {% if not check.name %}unnamed{% endif %}">
                            <div>{{ check.name|default:"unnamed" }}</div>
                            {% for tag in check.tags_list %}
                            <span class="label label-tag">{{ tag }}</span>
                            {% endfor %}


                        </div>
                    </td>
                    <td class="url-cell">
                        <span class="my-checks-url">
                            <span class="base">{{ ping_endpoint }}</span>{{ check.code }}
                        </span>
                        <button
                            class="copy-link hidden-sm"
                            data-clipboard-text="{{ check.url }}">
                            copy
                        </button>
                    </td>
                    <td class="timeout-cell">
                        <span
                            data-url="{% url 'hc-update-timeout' check.code %}"
                            data-timeout="{{ check.timeout.total_seconds }}"
                            data-grace="{{ check.grace.total_seconds }}"
                            class="timeout-grace">
                            {{ check.timeout|hc_duration }}
                            <br />
                            <span class="checks-subline">
                            {{ check.grace|hc_duration }}
                            </span>
                        </span>
                    </td>
                    <td>
                    {% if check.last_ping %}
                        <span
                            data-toggle="tooltip"
                            title="{{ check.last_ping|date:'N j, Y, P e' }}">
                            {{ check.last_ping|naturaltime }}
                        </span>
                    {% else %}
                        Never
                    {% endif %}
                    </td>
                    <td>
                        <div class="check-menu dropdown">
                            <button class="btn btn-sm btn-default dropdown-toggle" type="button" data-toggle="dropdown">
                            <span class="icon-settings" aria-hidden="true"></span>
                            </button>
                            <ul class="dropdown-menu">
                                <li {% if check.status == "new" or check.status == "paused" %}class="disabled"{% endif %}>
                                {% if scope.1 == True %}
                                    <a class="pause-check"
                                       href="#"
                                       data-url="{% url 'hc-pause' check.code %}">
                                       Pause Monitoring
                                    </a>
                                {% else %}
                                    <a class="disabled">Pause Disabled</a>
                                {% endif %}
                                </li>
                                <li role="separator" class="divider"></li>
                                <li {% if not scope.0 %} class="disabled" {% endif %} >
                                {% if scope.0 == True %}
                                    <a href="{% url 'hc-log' check.code %}">
                                        Log
                                    </a>
                                {% else %}
                                    <a class="disable"> Logs Are Disabled</a>
                                {% endif %}
                                </li>
                                <li>
                                    <a
                                        href="#"
                                        class="usage-examples"
                                        data-url="{{ check.url }}"
                                        data-email="{{ check.email }}">
                                        Usage Examples
                                    </a>
                                </li>
                                <li role="separator" class="divider"></li>
                                <li {% if not scope.2 %} class="disabled" {% endif %}>
                                {% if scope.2 == True %}
                                    <a href="#" class="check-menu-remove"
                                        data-name="{{ check.name_then_code }}"
                                        data-url="{% url 'hc-remove-check' check.code %}">
                                        Remove
                                    </a>
                                {% else %}
                                    <a class="disable" >Remove Check Disabled</a>
                                {% endif %}
                                </li>
                            </ul>
                        </div>
                    </td>
                </tr>

                {% endif %}

            {% endfor %}
            {{ scope }}
        {% else %}
            {% define true_scope as scope %}
            <tr class="checks-row">
            <td class="indicator-cell">
                {% if check.get_status == "new" %}
                    <span class="status icon-up new"
                        data-toggle="tooltip" title="New. Has never received a ping."></span>
                {% elif check.get_status == "paused" %}
                    <span class="status icon-paused"
                        data-toggle="tooltip" title="Monitoring paused. Ping to resume."></span>
                {% elif check.in_grace_period %}
                    <span class="status icon-grace"></span>
                {% elif check.get_status == "up" %}
                    <span class="status icon-up"></span>
                {% elif check.get_status == "down" %}
                    <span class="status icon-down"></span>
                {% endif %}
            </td>
            <td class="name-cell">
                <div data-name="{{ check.name }}"
                        data-tags="{{ check.tags }}"
                        data-url="{% url 'hc-update-name' check.code %}"
                        class="my-checks-name {% if not check.name %}unnamed{% endif %}">
                    <div>{{ check.name|default:"unnamed" }}</div>
                    {% for tag in check.tags_list %}
                    <span class="label label-tag">{{ tag }}</span>
                    {% endfor %}


                </div>
            </td>
            <td class="url-cell">
                <span class="my-checks-url">
                    <span class="base">{{ ping_endpoint }}</span>{{ check.code }}
                </span>
                <button
                    class="copy-link hidden-sm"
                    data-clipboard-text="{{ check.url }}">
                    copy
                </button>
            </td>
            <td class="timeout-cell">
                <span
                    data-url="{% url 'hc-update-timeout' check.code %}"
                    data-timeout="{{ check.timeout.total_seconds }}"
                    data-grace="{{ check.grace.total_seconds }}"
                    class="timeout-grace">
                    {{ check.timeout|hc_duration }}
                    <br />
                    <span class="checks-subline">
                    {{ check.grace|hc_duration }}
                    </span>
                </span>
            </td>
            <td>
            {% if check.last_ping %}
                <span
                    data-toggle="tooltip"
                    title="{{ check.last_ping|date:'N j, Y, P e' }}">
                    {{ check.last_ping|naturaltime }}
                </span>
            {% else %}
                Never
            {% endif %}
            </td>
            <td>
                <div class="check-menu dropdown">
                    <button class="btn btn-sm btn-default dropdown-toggle" type="button" data-toggle="dropdown">
                    <span class="icon-settings" aria-hidden="true"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li {% if check.status == "new" or check.status == "paused" or scope.1 == False %}class="disabled"{% endif %}>
                        {% if scope.1 == True %}
                            <a class="pause-check"
                               href="#"
                               data-url="{% url 'hc-pause' check.code %}">
                               Pause Monitoring
                            </a>
                        {% else %}
                            <a>Pause Disabled</a>
                        {% endif %}
                        </li>
                        <li role="separator" class="divider"></li>
                        <li {% if not scope.0 %} class="disabled" {% endif %}>
                        {% if scope.0 == True %}
                            <a href="{% url 'hc-log' check.code %}">
                                Log
                            </a>
                        {% else %}
                            <a> Logs Are Disabled</a>
                        {% endif %}
                        </li>
                        <li role="separator" class="divider"></li>
                        <li>
                            <a
                                href="#"
                                class="usage-examples"
                                data-url="{{ check.url }}"
                                data-email="{{ check.email }}">
                                Usage Examples
                            </a>
                        </li>
                        <li role="separator" class="divider"></li>
                        <li {% if scope.2 == "False" %} class="disabled" {% endif %}>
                        {% if scope.2 == True %}
                            <a href="#" class="check-menu-remove"
                                data-name="{{ check.name_then_code }}"
                                data-url="{% url 'hc-remove-check' check.code %}">
                                Remove
                            </a>
                        {% else %}
                        <a>Remove Disabled</a>
                        {% endif %}
                        </li>
                    </ul>
                </div>
            </td>
        </tr>
        {% endif %}
    {% endfor %}

</table>
